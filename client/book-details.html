<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Devil - Book Details</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/book-details.css">
    <link rel="icon" href="favicon1.ico" type="image/x-icon">
    <!-- JWT Decode Library -->
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <a href="index.html" class="logo">Code Devil</a>
            <div class="navbar-links" id="navbar-links">
                <a href="index.html">Home</a>
                <a href="courses.html">Courses</a>
                <a href="category.html">Categories</a>
                <a href="contact.html">Contact</a>
                <a href="admin.html" class="admin-only" style="display: none;">Admin</a>
                <a href="#" class="logout" id="logout-link" style="display: none;">Logout</a>
            </div>
            <div class="hamburger" id="menu-icon">‚ò∞</div>
            <div class="close-icon" id="close-icon">‚úñÔ∏è</div>
        </div>
    </nav>

    <main>
        <!-- Back Button -->
        <a href="#" class="back-btn" id="back-icon" onclick="window.history.back()">‚Üê Back</a>

        <div id="book-details">
            <div class="book-header">
                <h3 id="book-title">Loading...</h3>
                
                <!-- Book Image Container -->
                <div class="book-image-container">
                    <img id="book-image" src="" alt="Book Cover" style="display: none;" />
                </div>
                
                <!-- Book Meta Information -->
                <div class="book-meta">
                    <strong>Category:</strong> <span id="book-category">Loading...</span>
                </div>
                
                <!-- Book Description -->
                <div class="book-description">
                    <p id="book-description">Loading description...</p>
                </div>

                <!-- Notes Preview Section -->
                <div class="notes-preview-section">
                    <h4>üìñ Book Preview</h4>
                    <iframe id="notes-preview" 
                            src="" 
                            width="100%" 
                            height="400" 
                            frameborder="0"
                            sandbox="allow-scripts allow-same-origin"
                            style="border-radius: 8px; border: 2px solid #e9ecef; display: none;">
                    </iframe>
                    <p id="notes-preview-message" style="text-align: center; padding: 20px; color: #6c757d;">
                        PDF preview will load here...
                    </p>
                </div>
                
                <!-- Download Section -->
                <div class="book-download-section">
                    <button id="download-button" class="download-btn">üì• Download PDF</button>
                </div>
            </div>
        </div>

        <!-- Suggestions Section -->
        <div id="suggestions">
            <h4>üìö Related Books</h4>
            <div class="suggestions-grid">
                <ul id="suggestion-list" style="list-style: none; padding: 0; margin: 0;"></ul>
            </div>
        </div>

        
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
          const params = new URLSearchParams(window.location.search);
          const bookId = params.get('id');
          
          if (!bookId) {
            alert('No book specified');
            window.location.href = 'index.html';
            return;
          }
          
          try {
            const response = await fetch(`https://free-programming-notes.onrender.com/api/books/${bookId}`);
            if (!response.ok) throw new Error('Book not found');
            const book = await response.json();
      
            document.getElementById('book-title').textContent = book.title;
            document.getElementById('book-description').textContent = book.description;
            document.getElementById('book-image').src = book.imageUrl;
            document.getElementById('book-image').alt = `Cover image of ${book.title}`;
            document.getElementById('download-link').href = book.pdfUrl;
      
          } catch (err) {
            alert('Unable to load book details. Please try again later.');
            console.error(err);
            document.querySelector('.book-details-container').innerHTML = '<p>Failed to load book.</p>';
          }
        });
      </script>
      
    <script src="js/navbar.js"></script>
    <script src="js/book-details.js"></script>
    <script src="js/jwt-decode.js"></script>
</body>
</html>
